<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026å¹´åå¤å±‹å¤§é˜ª9æ—¥ä¹‹æ—…</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" >
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #E74C3C;
            --primary-dark: #C0392B;
            --secondary: #3498DB;
            --accent: #F39C12;
            --bg: #FDF6F0;
            --card-bg: #FFFFFF;
            --text: #2C3E50;
            --text-light: #7F8C8D;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --border-radius: 16px;
        }
        .dark {
            --primary: #FF6B5B;
            --primary-dark: #E74C3C;
            --secondary: #5DADE2;
            --accent: #F5B041;
            --bg: #1A1A2E;
            --card-bg: #16213E;
            --text: #ECF0F1;
            --text-light: #95A5A6;
            --shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Noto Sans TC', 'Zen Maru Gothic', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px 20px;
            text-align: center;
            position: relative;
            z-index: 1000;
        }
        header h1 {
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .header-icon {
            font-size: 1.5rem;
        }
        .day-nav {
            background: var(--card-bg);
            padding: 12px 8px;
            overflow-x: auto;
            white-space: nowrap;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 999;
            -webkit-overflow-scrolling: touch;
        }
        .day-nav::-webkit-scrollbar {
            height: 4px;
        }
        .day-nav::-webkit-scrollbar-track {
            background: transparent;
        }
        .day-nav::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        .day-tabs {
            display: inline-flex;
            gap: 8px;
            padding: 0 8px;
        }
        .day-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 16px;
            border-radius: 12px;
            background: transparent;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 72px;
            font-family: inherit;
            color: var(--text);
        }
        .day-tab:hover {
            background: rgba(231, 76, 60, 0.1);
        }
        .day-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }
        .day-tab .day-num {
            font-size: 1.1rem;
            font-weight: 700;
        }
        .day-tab .day-date {
            font-size: 0.7rem;
            opacity: 0.8;
            margin-top: 2px;
        }
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        #map {
            flex: 1;
            height: 100%;
            z-index: 1;
        }
        .sidebar {
            width: 360px;
            background: var(--card-bg);
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 2;
        }
        .day-header {
            background: linear-gradient(135deg, var(--secondary) 0%, #2980B9 100%);
            color: white;
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .day-header h2 {
            font-size: 1.1rem;
            font-weight: 700;
        }
        .day-header .day-subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 4px;
        }
        .location-list {
            padding: 12px;
        }
        .location-card {
            background: var(--bg);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .location-card:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow);
        }
        .location-card.active {
            border-left-color: var(--primary);
            background: white;
        }
        .dark .location-card.active {
            background: #1F2B47;
        }
        .location-header {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .location-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        .location-icon.hotel { background: linear-gradient(135deg, #9B59B6, #8E44AD); }
        .location-icon.food { background: linear-gradient(135deg, #E74C3C, #C0392B); }
        .location-icon.attraction { background: linear-gradient(135deg, #3498DB, #2980B9); }
        .location-icon.shopping { background: linear-gradient(135deg, #2ECC71, #27AE60); }
        .location-icon.transport { background: linear-gradient(135deg, #F39C12, #E67E22); }
        .location-info {
            flex: 1;
            min-width: 0;
        }
        .location-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        .location-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            line-height: 1.5;
        }
        .location-time {
            font-size: 0.75rem;
            color: var(--accent);
            font-weight: 500;
            margin-top: 6px;
        }
        /* Leaflet popup customization */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        .leaflet-popup-content {
            margin: 12px 16px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        .popup-title {
            font-weight: 700;
            font-size: 1rem;
            color: var(--primary);
            margin-bottom: 6px;
        }
        .popup-desc {
            font-size: 0.85rem;
            color: #555;
            line-height: 1.5;
        }
        .custom-marker {
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            border: 3px solid white;
        }
        /* Mobile responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column-reverse;
            }
            .sidebar {
                width: 100%;
                height: 45%;
                max-height: 45vh;
            }
            #map {
                height: 55%;
            }
            header h1 {
                font-size: 1.1rem;
            }
            .day-tab {
                min-width: 64px;
                padding: 8px 12px;
            }
        }
        /* Route line animation */
        .route-line {
            stroke-dasharray: 10, 10;
            animation: dash 30s linear infinite;
        }
        @keyframes dash {
            to {
                stroke-dashoffset: -1000;
            }
        }
        /* Loading animation */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            gap: 20px;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--text-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 1rem;
            color: var(--text-light);
        }
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: var(--card-bg);
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            z-index: 1000;
            font-size: 0.8rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        .legend-item:last-child {
            margin-bottom: 0;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">è¼‰å…¥è¡Œç¨‹åœ°åœ–ä¸­...</div>
    </div>

    <div class="app-container">
        <header>
            <h1><span class="header-icon">ğŸ—¾</span> 2026å¹´åå¤å±‹å¤§é˜ª9æ—¥ä¹‹æ—…</h1>
        </header>

        <nav class="day-nav">
            <div class="day-tabs" id="dayTabs"></div>
        </nav>

        <div class="main-content">
            <div id="map"></div>
            <aside class="sidebar" id="sidebar"></aside>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Itinerary data with coordinates
        const itineraryData = {
            1: {
                date: "2026/1/17",
                weekday: "æ˜ŸæœŸå…­",
                title: "é¦™æ¸¯ â†’ åå¤å±‹",
                locations: [
                    { name: "é¦™æ¸¯åœ‹éš›æ©Ÿå ´", type: "transport", lat: 22.3080, lng: 113.9185, desc: "UO680 10:00å‡ºç™¼", time: "10:00" },
                    { name: "æ–°ç‰¹éº—äºåå¤å±‹ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", type: "transport", lat: 34.8584, lng: 136.8125, desc: "14:30æŠµé”", time: "14:30" },
                    { name: "å¤§å’ŒROYNETé£¯åº— åå¤å±‹å¤ªé–£é€šå£", type: "hotel", lat: 35.1699, lng: 136.8815, desc: "JRåå¤å±‹é§…å¤ªé–¤é€šå£å¾’æ­¥ç´„4åˆ†", time: "15:30" },
                    { name: "åéµç™¾è²¨ãƒ»JRé«˜å³¶å±‹ãƒ»è¿‘éµPass'e", type: "shopping", lat: 35.1706, lng: 136.8829, desc: "åå¤å±‹ç«™å‘¨é‚Šè³¼ç‰©", time: "16:00" },
                    { name: "SUGIè—¥å±€åé§…åŒ—åº—", type: "shopping", lat: 35.1715, lng: 136.8810, desc: "è³¼è²·è—¥å¦", time: "17:00" },
                    { name: "Katuretu MATUMURA / éººå®¶ ç…å­ä¸¸", type: "food", lat: 35.1695, lng: 136.8835, desc: "ç‚¸è±¬æ’ï¼2025ç™¾ååº—é›ç™½æ¹¯æ‹‰éºµ", time: "18:30" }
                ]
            },
            2: {
                date: "2026/1/18",
                weekday: "æ˜ŸæœŸæ—¥",
                title: "åå¤å±‹ â†’ å²¡å´Outlet â†’ æ¦®ç”º",
                locations: [
                    { name: "CafÃ© de CriÃ© åé§…è¥¿å£åº—", type: "food", lat: 35.1688, lng: 136.8795, desc: "åå¤å±‹ç‰¹è‰²æ—©é¤", time: "08:00" },
                    { name: "åéµåå¤å±‹ç«™", type: "transport", lat: 35.1702, lng: 136.8815, desc: "æ­ä¹˜åéµæ€¥è¡Œå¾€è±æ©‹æ–¹å‘", time: "09:30" },
                    { name: "æœ¬å®¿ç«™", type: "transport", lat: 34.9258, lng: 137.1647, desc: "è½‰ä¹˜å…è²»æ¥é€å·´å£«", time: "10:45" },
                    { name: "MITSUI OUTLET PARKå²¡å´", type: "shopping", lat: 34.9315, lng: 137.1580, desc: "è³¼ç‰©ãƒ»åˆé¤ï¼šå›ã®ãƒãƒ³ãƒãƒ¼ã‚°ã‚’é£Ÿã¹ãŸã„", time: "11:00" },
                    { name: "æ¦®ç”ºå•†åœˆ", type: "attraction", lat: 35.1681, lng: 136.9086, desc: "åå¤å±‹é›»è¦–å¡”ã€ç¶ æ´²21ã€ä¹…å±‹å¤§é€šå…¬åœ’", time: "16:00" },
                    { name: "Sunshine Sakae æ‘©å¤©è¼ª", type: "attraction", lat: 35.1695, lng: 136.9095, desc: "åœ°æ¨™æ€§æ™¯é»", time: "17:00" },
                    { name: "å”å‰è»»å¾· æ¦®åº—", type: "shopping", lat: 35.1688, lng: 136.9080, desc: "å¿…é€›æ——è‰¦åº—", time: "17:30" },
                    { name: "é»‘è±šå±‹ ã‚‰ã‚€ã¡ãƒ / ã¨ã‚“ã‹ã¤ã®è—¤", type: "food", lat: 35.1675, lng: 136.9070, desc: "åå¤å±‹å‘³å™Œè±¬æ’", time: "19:00" }
                ]
            },
            3: {
                date: "2026/1/19",
                weekday: "æ˜ŸæœŸä¸€",
                title: "åå¤å±‹ â†’ ä¸‹å‘‚æº«æ³‰",
                locations: [
                    { name: "åå¤å±‹ç«™", type: "transport", lat: 35.1706, lng: 136.8816, desc: "é–‹å§‹ä½¿ç”¨é«˜å±±åŒ—é™¸å€åŸŸå‘¨éŠåˆ¸ãƒ»10:48å‡ºç™¼", time: "10:48" },
                    { name: "ä¸‹å‘‚ç«™", type: "transport", lat: 35.8055, lng: 137.2432, desc: "JRé£›å½ˆç‰¹æ€¥ãƒ»12:27æŠµé”", time: "12:27" },
                    { name: "ãŠé£Ÿäº‹å‡¦ è©å±‹ã‚±ã‚¤ã¡ã‚ƒã‚“", type: "food", lat: 35.8048, lng: 137.2445, desc: "åˆé¤", time: "12:45" },
                    { name: "æ°´æ˜é¤¨", type: "hotel", lat: 35.8035, lng: 137.2468, desc: "æº«æ³‰æ—…é¤¨ãƒ»æ™šé¤å·²åŒ…æ‹¬", time: "14:00" },
                    { name: "ä¸‹å‘‚æº«æ³‰è¡—", type: "attraction", lat: 35.8042, lng: 137.2455, desc: "ä¸‹å‘‚å¸ƒä¸ã€GERO GERO Butter Standã€æº«æ³‰è›‹é›ªç³•", time: "15:00" },
                    { name: "ä¸‹å‘‚æº«æ³‰åˆæŒæ‘", type: "attraction", lat: 35.8125, lng: 137.2510, desc: "å‚³çµ±åˆæŒé€ å»ºç¯‰", time: "16:00" }
                ]
            },
            4: {
                date: "2026/1/20",
                weekday: "æ˜ŸæœŸäºŒ",
                title: "ä¸‹å‘‚æº«æ³‰ â†’ é«˜å±±",
                locations: [
                    { name: "æ°´æ˜é¤¨", type: "hotel", lat: 35.8035, lng: 137.2468, desc: "æ—©é¤å·²åŒ…æ‹¬ï¼ˆå’Œæ´‹è‡ªåŠ©é¤ï¼‰", time: "07:00" },
                    { name: "ä¸‹å‘‚ç«™", type: "transport", lat: 35.8055, lng: 137.2432, desc: "11:30å‡ºç™¼", time: "11:30" },
                    { name: "é«˜å±±ç«™", type: "transport", lat: 36.1425, lng: 137.2520, desc: "JRé£›å½ˆç‰¹æ€¥ãƒ»12:14æŠµé”", time: "12:14" },
                    { name: "å‘³ã®ä¸å¹³", type: "food", lat: 36.1398, lng: 137.2565, desc: "åˆé¤", time: "12:30" },
                    { name: "Hotel and Spa Gift Takayama", type: "hotel", lat: 36.1415, lng: 137.2535, desc: "å…¥ä½é…’åº—", time: "15:00" },
                    { name: "é«˜å±±è€è¡—ï¼ˆä¸Šä¸‰ä¹‹ç”ºï¼‰", type: "attraction", lat: 36.1402, lng: 137.2585, desc: "é£›é©’å°äº¬éƒ½ãƒ»é£›é©’ç‰›æ¡å£½å¸ãƒ»é«˜å±±å¸ƒä¸", time: "15:30" },
                    { name: "ä¸¸æ˜ é£›é©’é«˜å±±åº—", type: "food", lat: 36.1395, lng: 137.2575, desc: "æ™šé¤ï¼ˆWalk-in Onlyãƒ»ä¸­åˆå…ˆé ç´„ï¼‰", time: "18:00" }
                ]
            },
            5: {
                date: "2026/1/21",
                weekday: "æ˜ŸæœŸä¸‰",
                title: "é«˜å±± â†’ ç™½å·é„‰ â†’ é«˜å±±",
                locations: [
                    { name: "Hotel and Spa Gift Takayama", type: "hotel", lat: 36.1415, lng: 137.2535, desc: "æ—©é¤å·²åŒ…æ‹¬", time: "07:30" },
                    { name: "å®®å·æœå¸‚", type: "attraction", lat: 36.1435, lng: 137.2580, desc: "å‚³çµ±æ—©å¸‚", time: "08:30" },
                    { name: "é«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒ", type: "transport", lat: 36.1420, lng: 137.2510, desc: "12:10å‡ºç™¼å¾€ç™½å·é„‰", time: "12:10" },
                    { name: "ç™½å·é„‰åˆæŒæ‘", type: "attraction", lat: 36.2575, lng: 136.9062, desc: "ä¸–ç•Œéºç”¢ãƒ»13:00æŠµé”", time: "13:00" },
                    { name: "è•éº¥éºµ ä¹ƒã‚€ã‚‰", type: "food", lat: 36.2568, lng: 136.9055, desc: "åˆé¤", time: "13:30" },
                    { name: "ç™½å·é„‰å·´å£«ç«™", type: "transport", lat: 36.2572, lng: 136.9058, desc: "16:35å‡ºç™¼è¿”å›é«˜å±±", time: "16:35" },
                    { name: "Le Midi", type: "food", lat: 36.1405, lng: 137.2555, desc: "æ™šé¤", time: "18:00" }
                ]
            },
            6: {
                date: "2026/1/22",
                weekday: "æ˜ŸæœŸå››",
                title: "é«˜å±± â†’ å¯Œå±± â†’ è˜†åŸæº«æ³‰",
                locations: [
                    { name: "Hotel and Spa Gift Takayama", type: "hotel", lat: 36.1415, lng: 137.2535, desc: "æ—©é¤å·²åŒ…æ‹¬", time: "08:00" },
                    { name: "é«˜å±±ç«™", type: "transport", lat: 36.1425, lng: 137.2520, desc: "11:03å‡ºç™¼", time: "11:03" },
                    { name: "å¯Œå±±ç«™", type: "transport", lat: 36.7014, lng: 137.2130, desc: "JRé£›å½ˆç‰¹æ€¥ãƒ»12:32æŠµé”", time: "12:32" },
                    { name: "å¯Œå±±ç«™é¤å»³", type: "food", lat: 36.7010, lng: 137.2135, desc: "åˆé¤ãƒ»è³¼è²·ç™½è¦ä»™è²ã€é±’é­šå£½å¸ç­‰ç‰¹ç”¢", time: "12:45" },
                    { name: "è˜†åŸæº«æ³‰ç«™", type: "transport", lat: 36.2235, lng: 136.2285, desc: "åŒ—é™¸æ–°å¹¹ç·šãƒ»14:32æŠµé”", time: "14:32" },
                    { name: "ã‚°ãƒ©ãƒ³ãƒ‡ã‚£ã‚¢èŠ³æ³‰", type: "hotel", lat: 36.2185, lng: 136.2220, desc: "æº«æ³‰æ—…é¤¨ãƒ»æ™šé¤å·²åŒ…æ‹¬ï¼ˆé«˜ç´šè‡ªåŠ©é¤+ç„¡é™æš¢é£²ï¼‰", time: "15:00" }
                ]
            },
            7: {
                date: "2026/1/23",
                weekday: "æ˜ŸæœŸäº”",
                title: "è˜†åŸæº«æ³‰ â†’ å¤§é˜ª",
                locations: [
                    { name: "ã‚°ãƒ©ãƒ³ãƒ‡ã‚£ã‚¢èŠ³æ³‰", type: "hotel", lat: 36.2185, lng: 136.2220, desc: "æ—©é¤å·²åŒ…æ‹¬ï¼ˆBuffet Styleï¼‰", time: "07:00" },
                    { name: "è˜†åŸæº«æ³‰ç«™", type: "transport", lat: 36.2235, lng: 136.2285, desc: "10:32å‡ºç™¼", time: "10:32" },
                    { name: "æ•¦è³€ç«™", type: "transport", lat: 35.6455, lng: 136.0565, desc: "åŒ—é™¸æ–°å¹¹ç·šè½‰ä¹˜JRé›·é³¥ç‰¹æ€¥", time: "11:14" },
                    { name: "å¤§é˜ªç«™", type: "transport", lat: 34.7024, lng: 135.4959, desc: "12:36æŠµé”", time: "12:36" },
                    { name: "Hotel Hankyu RESPIRE OSAKA", type: "hotel", lat: 34.7035, lng: 135.4985, desc: "æ¢…ç”°åœ°å€", time: "13:00" },
                    { name: "ã™ãç„¼ ã—ã‚ƒã¶ã—ã‚ƒã¶ã¤ã‹ã  KITTEå¤§é˜ª", type: "food", lat: 34.7028, lng: 135.4965, desc: "åˆé¤", time: "13:30" },
                    { name: "ã‚ˆã¤è‘‰ãƒ›ãƒ¯ã‚¤ãƒˆã‚³ãƒ¼ã‚¸ KITTEå¤§é˜ªåº—", type: "food", lat: 34.7028, lng: 135.4965, desc: "ç”œå“", time: "15:00" },
                    { name: "Grand Green Osakaãƒ»LUCUAãƒ»Grand Front Osaka", type: "shopping", lat: 34.7045, lng: 135.4945, desc: "æ¢…ç”°è³¼ç‰©", time: "15:30" },
                    { name: "é“é “å´›ãƒ»å¿ƒé½‹æ©‹", type: "attraction", lat: 34.6687, lng: 135.5012, desc: "å¤§é˜ªå¿…è¨ªæ™¯é»", time: "17:30" },
                    { name: "ä¸‡ä¸¡ æ—¥æœ¬æ©‹åº— / ç„¼è‚‰åŠ›ä¸¸", type: "food", lat: 34.6675, lng: 135.5025, desc: "æ™šé¤", time: "19:00" }
                ]
            },
            8: {
                date: "2026/1/24",
                weekday: "æ˜ŸæœŸå…­",
                title: "å¤§é˜ª â†’ äº¬éƒ½ä¸€æ—¥éŠ",
                locations: [
                    { name: "Hotel Hankyu RESPIRE OSAKA", type: "hotel", lat: 34.7035, lng: 135.4985, desc: "æ—©é¤å·²åŒ…æ‹¬", time: "08:00" },
                    { name: "å¤§é˜ªç«™", type: "transport", lat: 34.7024, lng: 135.4959, desc: "09:41å‡ºç™¼", time: "09:41" },
                    { name: "äº¬éƒ½ç«™", type: "transport", lat: 34.9858, lng: 135.7587, desc: "JRé›·é³¥ãƒ»10:07æŠµé”", time: "10:07" },
                    { name: "é‡‘é–£å¯º", type: "attraction", lat: 35.0394, lng: 135.7292, desc: "ä¸–ç•Œéºç”¢", time: "11:00" },
                    { name: "æ²³åŸç”ºä¸‰æ¡", type: "attraction", lat: 35.0088, lng: 135.7695, desc: "å¸‚ä¸­å¿ƒãƒ»åˆé¤ï¼šäº¬éƒ½ç„¼è‚‰ enen", time: "12:30" },
                    { name: "Berry Button", type: "food", lat: 35.0085, lng: 135.7690, desc: "ç”œå“", time: "14:00" },
                    { name: "å…ˆæ–—ç”ºãƒ»é´¨å·", type: "attraction", lat: 35.0055, lng: 135.7705, desc: "å‚³çµ±è¡—é“", time: "14:30" },
                    { name: "ç¥‡åœ’èŠ±è¦‹å°è·¯", type: "attraction", lat: 35.0025, lng: 135.7755, desc: "è—å¦“å€", time: "15:30" },
                    { name: "å…«å‚ç¥ç¤¾", type: "attraction", lat: 35.0036, lng: 135.7785, desc: "è‘—åç¥ç¤¾", time: "16:00" },
                    { name: "äºŒå¯§å‚ãƒ»ä¸‰å¹´å‚", type: "attraction", lat: 34.9985, lng: 135.7795, desc: "çŸ³å¡€å°è·¯", time: "16:30" },
                    { name: "æ¸…æ°´å¯º", type: "attraction", lat: 34.9949, lng: 135.7850, desc: "ä¸–ç•Œéºç”¢", time: "17:00" },
                    { name: "äº¬éƒ½ç«™", type: "transport", lat: 34.9858, lng: 135.7587, desc: "è¿”å›å¤§é˜ª", time: "18:30" },
                    { name: "æ¢…ç”° é‡œãŸã‘ã†ã©ã‚“ / éººå±‹ãŸã‘äº•", type: "food", lat: 34.7030, lng: 135.4970, desc: "æ™šé¤", time: "19:30" }
                ]
            },
            9: {
                date: "2026/1/25",
                weekday: "æ˜ŸæœŸæ—¥",
                title: "å¤§é˜ª â†’ é¦™æ¸¯",
                locations: [
                    { name: "Hotel Hankyu RESPIRE OSAKA", type: "hotel", lat: 34.7035, lng: 135.4985, desc: "æ—©é¤å·²åŒ…æ‹¬ãƒ»é€€æˆ¿", time: "09:00" },
                    { name: "å¤§é˜ªç«™", type: "transport", lat: 34.7024, lng: 135.4959, desc: "11:03å‡ºç™¼", time: "11:03" },
                    { name: "é—œè¥¿åœ‹éš›æ©Ÿå ´", type: "transport", lat: 34.4347, lng: 135.2441, desc: "JR HARUKAç‰¹æ€¥ãƒ»11:50æŠµé”", time: "11:50" },
                    { name: "é—œè¥¿æ©Ÿå ´é¤å»³", type: "food", lat: 34.4345, lng: 135.2445, desc: "åˆé¤", time: "12:00" },
                    { name: "é¦™æ¸¯åœ‹éš›æ©Ÿå ´", type: "transport", lat: 22.3080, lng: 113.9185, desc: "UO687 14:15å‡ºç™¼ãƒ»18:00æŠµé”", time: "18:00" }
                ]
            }
        };

        // Icon mapping
        const iconEmojis = {
            hotel: "ğŸ¨",
            food: "ï¿½ï¿½ï¿½ï¿½ï¸",
            attraction: "â›©ï¸",
            shopping: "ğŸ›ï¸",
            transport: "ğŸšƒ"
        };

        // Initialize map
        let map;
        let markers = [];
        let routeLine = null;
        let currentDay = 1;

        function initMap() {
            map = L.map('map', {
                zoomControl: true,
                scrollWheelZoom: true
            }).setView([35.5, 137.0], 7);

            // Add tile layer (using light/dark based on theme)
            const isDark = document.documentElement.classList.contains('dark');
            L.tileLayer('https://{s}.basemaps.cartocdn.com/' + (isDark ? 'dark_all' : 'rastertiles/voyager') + '/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/">CARTO</a>',
                maxZoom: 19
            }).addTo(map);

            // Add legend
            addLegend();
        }

        function addLegend() {
            const legend = L.control({ position: 'bottomleft' });
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = `
                    <div class="legend-item"><div class="legend-color" style="background: #9B59B6"></div><span>é…’åº—</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #E74C3C"></div><span>é¤é£²</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #3498DB"></div><span>æ™¯é»</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #2ECC71"></div><span>è³¼ç‰©</span></div>
                    <div class="legend-item"><div class="legend-color" style="background: #F39C12"></div><span>äº¤é€š</span></div>
                `;
                return div;
            };
            legend.addTo(map);
        }

        function createDayTabs() {
            const tabsContainer = document.getElementById('dayTabs');
            for (let i = 1; i <= 9; i++) {
                const day = itineraryData[i];
                const tab = document.createElement('button');
                tab.className = 'day-tab' + (i === 1 ? ' active' : '');
                tab.innerHTML = `
                    <span class="day-num">Day ${i}</span>
                    <span class="day-date">${day.date.split('/').slice(1).join('/')}</span>
                `;
                tab.onclick = () => selectDay(i);
                tabsContainer.appendChild(tab);
            }
        }

        function selectDay(dayNum) {
            currentDay = dayNum;

            // Update tab styles
            document.querySelectorAll('.day-tab').forEach((tab, index) => {
                tab.classList.toggle('active', index + 1 === dayNum);
            });

            // Update map and sidebar
            updateMap(dayNum);
            updateSidebar(dayNum);
        }

        function getMarkerColor(type) {
            const colors = {
                hotel: '#9B59B6',
                food: '#E74C3C',
                attraction: '#3498DB',
                shopping: '#2ECC71',
                transport: '#F39C12'
            };
            return colors[type] || '#E74C3C';
        }

        function createCustomIcon(index, type) {
            const color = getMarkerColor(type);
            return L.divIcon({
                className: 'custom-div-icon',
                html: `<div style="
                    background: ${color};
                    color: white;
                    border-radius: 50%;
                    width: 28px;
                    height: 28px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 700;
                    font-size: 0.75rem;
                    box-shadow: 0 3px 10px rgba(0,0,0,0.3);
                    border: 2px solid white;
                    font-family: 'Noto Sans TC', sans-serif;
                ">${index}</div>`,
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            });
        }

        function updateMap(dayNum) {
            // Clear existing markers and route
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            if (routeLine) {
                map.removeLayer(routeLine);
            }

            const day = itineraryData[dayNum];
            const bounds = [];
            const routePoints = [];

            day.locations.forEach((loc, index) => {
                const marker = L.marker([loc.lat, loc.lng], {
                    icon: createCustomIcon(index + 1, loc.type)
                }).addTo(map);

                marker.bindPopup(`
                    <div class="popup-title">${iconEmojis[loc.type]} ${loc.name}</div>
                    <div class="popup-desc">${loc.desc}</div>
                    ${loc.time ? `<div style="margin-top: 6px; color: #F39C12; font-weight: 500;">${loc.time}</div>` : ''}
                `);

                marker.on('click', () => {
                    highlightLocation(index);
                });

                markers.push(marker);
                bounds.push([loc.lat, loc.lng]);
                routePoints.push([loc.lat, loc.lng]);
            });

            // Draw route line
            if (routePoints.length > 1) {
                routeLine = L.polyline(routePoints, {
                    color: '#E74C3C',
                    weight: 3,
                    opacity: 0.7,
                    dashArray: '10, 10',
                    className: 'route-line'
                }).addTo(map);
            }

            // Fit bounds with padding
            if (bounds.length > 0) {
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }

        function updateSidebar(dayNum) {
            const sidebar = document.getElementById('sidebar');
            const day = itineraryData[dayNum];

            let html = `
                <div class="day-header">
                    <h2>Day ${dayNum} - ${day.weekday}</h2>
                    <div class="day-subtitle">${day.title}</div>
                </div>
                <div class="location-list">
            `;

            day.locations.forEach((loc, index) => {
                html += `
                    <div class="location-card" data-index="${index}" onclick="focusLocation(${index})">
                        <div class="location-header">
                            <div class="location-icon ${loc.type}">${iconEmojis[loc.type]}</div>
                            <div class="location-info">
                                <div class="location-name">${loc.name}</div>
                                <div class="location-desc">${loc.desc}</div>
                                ${loc.time ? `<div class="location-time">â° ${loc.time}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            sidebar.innerHTML = html;
        }

        function focusLocation(index) {
            const day = itineraryData[currentDay];
            const loc = day.locations[index];

            map.setView([loc.lat, loc.lng], 15, { animate: true });
            markers[index].openPopup();
            highlightLocation(index);
        }

        function highlightLocation(index) {
            document.querySelectorAll('.location-card').forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });

            // Scroll to the card
            const activeCard = document.querySelector(`.location-card[data-index="${index}"]`);
            if (activeCard) {
                activeCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }

        // Initialize app
        window.onload = function() {
            initMap();
            createDayTabs();
            selectDay(1);

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 800);
        };
    </script>
</body>
</html>